{"ast":null,"code":"import _ from 'lodash';\nimport { loginAPI, authAPI, refreshAPI } from '../api/auth';\nexport var LOGIN_CLEAR = 'LOGIN_CLEAR';\nexport var LOGIN_LOAD = 'LOGIN_LOAD';\nexport var LOGIN_UNLOAD = 'LOGIN_UNLOAD';\nexport var LOGIN_SUCCESS = 'LOGIN_SUCCESS';\nexport var LOGIN_FAIL = 'LOGIN_FAIL';\nexport var LOGIN_CHECK = 'LOGIN_CHECK';\nexport var SET_TOKEN = 'SET_TOKEN';\nexport var LOGOUT = 'LOGOUT';\n\nfunction loginClearAction() {\n  return {\n    type: LOGIN_CLEAR\n  };\n}\n\nfunction loginLoadAction() {\n  return {\n    type: LOGIN_LOAD\n  };\n}\n\nexport function loginUnloadAction() {\n  return {\n    type: LOGIN_UNLOAD\n  };\n}\n\nfunction loginSuccessAction(token) {\n  return {\n    type: LOGIN_SUCCESS,\n    payload: {\n      token: token\n    }\n  };\n}\n\nfunction loginFailAction(errors) {\n  return {\n    type: LOGIN_FAIL,\n    payload: {\n      errors: errors\n    }\n  };\n}\n\nexport function loginCheckerAction(fields) {\n  return {\n    type: LOGIN_CHECK,\n    payload: {\n      fields: fields\n    }\n  };\n}\nexport function loginAction(username, password) {\n  return function (dispatch, getState) {\n    dispatch(loginClearAction());\n    dispatch(loginLoadAction());\n    dispatch(loginCheckerAction({\n      username: username,\n      password: password\n    }));\n\n    if (_.isEmpty(getState().auth.errors)) {\n      loginAPI({\n        username: username,\n        password: password\n      }).then(function (res) {\n        var data = res.data;\n\n        if (data.status_code === 200) {\n          var token = {\n            refresh: data.refresh,\n            access: data.access\n          };\n          dispatch(loginSuccessAction(token));\n        } else {\n          dispatch(loginFailAction(data.detail));\n        }\n      });\n    } else {\n      dispatch(loginUnloadAction());\n    }\n  };\n}\n\nfunction setTokenAction(token) {\n  return {\n    type: SET_TOKEN,\n    payload: {\n      token: token\n    }\n  };\n}\n\nexport function authorizeAction() {\n  return function (dispatch, getState) {\n    var token = getState().auth.token;\n    dispatch(loginLoadAction());\n    authAPI(token).then(function (authRes) {\n      if (authRes.data.status_code !== 200) {\n        refreshAPI(token).then(function (refreshRes) {\n          if (refreshRes.data.status_code !== 200) {\n            dispatch(setTokenAction({}));\n          } else {\n            var newToken = {\n              refresh: token.refresh,\n              access: refreshRes.data.access\n            };\n            dispatch(setTokenAction(newToken));\n          }\n        });\n      } else {\n        dispatch(setTokenAction(token));\n      }\n    });\n  };\n}\nexport function logoutAction() {\n  return {\n    type: LOGOUT\n  };\n}","map":null,"metadata":{},"sourceType":"module"}