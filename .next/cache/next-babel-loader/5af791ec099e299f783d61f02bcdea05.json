{"ast":null,"code":"import _ from 'lodash';\nimport { loginAPI, authAPI } from '../api/auth';\nimport { pageLoadingAction } from './page';\nexport const LOGIN_CLEAR = 'LOGIN_CLEAR';\nexport const LOGIN_SUCCESS = 'LOGIN_SUCCESS';\nexport const LOGIN_FAIL = 'LOGIN_FAIL';\nexport const LOGIN_CHECK = 'LOGIN_CHECK';\nexport const SET_AUTH = 'SET_AUTH';\nexport const LOGOUT = 'LOGOUT';\nexport function loginClearAction() {\n  return {\n    type: LOGIN_CLEAR\n  };\n}\n\nfunction loginSuccessAction(token) {\n  return {\n    type: LOGIN_SUCCESS,\n    payload: {\n      token\n    }\n  };\n}\n\nfunction loginFailAction(errors) {\n  return {\n    type: LOGIN_FAIL,\n    payload: {\n      errors\n    }\n  };\n}\n\nexport function loginCheckerAction(fields) {\n  return {\n    type: LOGIN_CHECK,\n    payload: {\n      fields\n    }\n  };\n}\nexport function loginAction(username, password) {\n  return (dispatch, getState) => {\n    dispatch(pageLoadingAction(true));\n    dispatch(loginClearAction());\n    dispatch(loginCheckerAction({\n      username,\n      password\n    }));\n\n    if (_.isEmpty(getState().auth.errors)) {\n      loginAPI({\n        username,\n        password\n      }).then(res => {\n        const {\n          data\n        } = res;\n\n        if (data.status_code === 200) {\n          dispatch(loginSuccessAction(data.access));\n          dispatch(pageLoadingAction(false));\n        } else {\n          dispatch(loginFailAction(data.detail));\n          dispatch(pageLoadingAction(false));\n        }\n      });\n    } else {\n      dispatch(pageLoadingAction(false));\n    }\n  };\n}\n\nfunction setAuthAction(auth) {\n  return {\n    type: SET_AUTH,\n    payload: {\n      auth\n    }\n  };\n}\n\nexport function authorizeAction(token) {\n  return dispatch => {\n    return authAPI(token).then(res => {\n      if (res.data.status_code !== 200) {\n        dispatch(setAuthAction(false));\n        return false;\n      }\n\n      dispatch(setAuthAction(true));\n      return true;\n    });\n  };\n}\nexport function logoutAction() {\n  return {\n    type: LOGOUT\n  };\n}","map":null,"metadata":{},"sourceType":"module"}